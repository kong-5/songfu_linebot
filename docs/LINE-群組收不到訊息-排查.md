# LINE 群組收不到訊息／顯示未綁定 排查

## 1. 確認機器人已加入該群組

- 收單**只支援群組**，不支援一對一聊天。
- 請在 LINE 群組內確認：**已將本官方帳號（機器人）加入群組**。
- 若機器人不在群組內，LINE 不會把群組訊息送到你的 Webhook，後台不會收到任何事件。

## 2. 確認 Webhook 有收到事件（看 Cloud Run 日誌）

- 到 Google Cloud Console → Cloud Run → 你的服務 → **日誌**。
- 在群組傳一則訊息（例如：「取得群組ID」）。
- 若日誌出現：
  - `[LINE] 處理 events 數量: 1`、`[LINE] 群組 ID：C...` → 代表有收到，問題多半是**綁定**。
  - `[LINE] 非群組訊息 source.type= user` → 代表這則是在「與機器人一對一」聊天發的，不是群組；請改在**群組裡**傳。
  - 完全沒有 `[LINE]` 日誌 → Webhook 沒被呼叫，請檢查：
    - LINE Developers Console → 該 Channel → Messaging API → **Webhook URL** 是否正確（需可從外網連到）。
    - **Use webhook** 是否為 Enabled。

## 3. 綁定「LINE 群組 ID」（後台與群組一致）

- 在**該群組**裡傳：**取得群組ID**（或「群組ID」），機器人會回覆一串 ID（例如 `C48764d2a8908f997740d3d1408588d4a`）。
- 到後台 **客戶管理** → 點該客戶 **編輯** → 在「**LINE 群組 ID**」欄位**貼上剛才機器人回覆的那串 ID**（建議直接複製貼上，避免手打或漏字）→ **儲存**。
- 系統比對時會忽略前後空白與大小寫；儲存時也會自動去掉欄位內所有空白。若仍顯示未綁定，請確認：
  - 該客戶為**啟用**狀態（未勾選「停用」）。
  - 貼上的 ID 與群組內「取得群組ID」回覆的**完全一致**（可再傳一次「取得群組ID」比對）。

## 4. 若仍異常

- 在群組再傳一次「取得群組ID」，把機器人回覆的 ID 與後台該客戶的「LINE 群組 ID」一字一字比對。
- 查看 Cloud Run 日誌中 `[LINE] 綁定查詢 groupId=... customer=無` 的 `groupId` 是否與後台儲存的值一致（含長度，通常為 33 字元）。
